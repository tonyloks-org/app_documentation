# Задачи

## Оглавление
1. [Создание задачи](#создание-задачи)
2. [Опции обновления данных](#опции-обновления-данных)
3. [Тип задачи](#тип-задачи)
4. [Настройка интервальных задач](#настройка-интервальных-задач)
5. [Часовые пояса и планирование задач](#часовые-пояса-и-планирование-задач)
6. [Индикаторы статуса задач](#индикаторы-статуса-задач)
7. [Дополнительные заметки](#дополнительные-заметки)

---

## Создание задачи

Для создания задачи, которая экспортирует данные на основе вашего шаблона, выполните следующие шаги:

1. **Выбор шаблона**: Выберите ранее настроенный шаблон.
2. **Выбор аккаунтов**: Выберите аккаунты, из которых вы хотите экспортировать данные. Можно выбрать несколько аккаунтов или все доступные для удобства.
3. **Выбор хранилища**: Выберите ранее настроенное хранилище.
4. **Тип создания таблиц**: Этот параметр определяет, как данные будут организованы в хранилище.

   - **Автоматически создать таблицы**:
     - Приложение создаст отдельные базы данных и таблицы для каждого аккаунта.
     - Названия баз данных основываются на названии вашего проекта из страницы «Подключения», переведенном в латиницу.
     - Полезно, когда нужно хранить данные разных аккаунтов отдельно, например, для предоставления доступа отдельным клиентам или сотрудникам.
   
   - **В одну таблицу**:
     - Все данные из выбранных аккаунтов будут объединены в одной таблице в одной базе данных.
     - Удобно, когда требуется создать сводные дашборды с данными из нескольких аккаунтов.
     - Необходимо указать название базы данных и таблицы.

---

## Опции обновления данных

Этот параметр контролирует, как данные обновляются в ваших таблицах:

1. **Полная перезапись**:
   - Приложение удалит все существующие данные в таблице и запишет новые данные.
   - **Применение**:
     - Подходит для небольших таблиц с ограниченным объемом данных (например, данные из Google Sheets или содержание объявлений из Яндекс Директа с несколькими тысячами строк).
     - Не рекомендуется для больших наборов данных за несколько лет, так как это требует много ресурсов.

2. **Присоединение**:
   - Новые данные будут добавлены в существующую таблицу без удаления старых данных.
   - Приложение не обрабатывает и не удаляет существующие данные.
   - **Применение**:
     - Полезно, когда нужно постоянно добавлять новые данные без изменения существующих записей.

3. **Перезапись по датам**:
   - Приложение удалит данные в указанном диапазоне дат и вставит новые данные за этот диапазон.
   - Позволяет обновлять недавние данные без затрагивания исторических данных.
   - **Поле для обновления**:
     - Необходимо указать поле, которое представляет дату в ваших данных (например, «Дата»).
     - Приложение использует это поле для определения, какие данные удалить и перезаписать.
     - Для этой цели можно выбрать только поля с датами.

---

## Тип задачи

Вы можете выбрать, как и когда будет выполняться задача:

1. **Единоразовая**:
   - Задача выполнится один раз, экспортируя данные за указанный диапазон дат.
   - **Применение**:
     - Идеально для экспорта исторических данных, которые не меняются (например, данные за последние два года).
   - **Настройка**:
     - Укажите начальную и конечную даты для экспорта данных.

2. **Интервальная**:
   - Задача запланирована на выполнение через определенные интервалы (например, ежедневно).
   - **Применение**:
     - Подходит для регулярного обновления данных в ваших таблицах.
   - **Настройка**:
     - Необходимо настроить дополнительные параметры для планирования и диапазона данных.

---

## Настройка интервальных задач

При выборе «Интервальная» в качестве типа задачи необходимо настроить следующие параметры:

1. **До какой даты**:
   - Указывает конечную дату для экспорта данных.
   - **Пример**:
     - Если вы хотите обновить данные до сегодня, выберите «Сегодня».
   - **Примечание**:
     - Для некоторых источников данных (например, Яндекс Метрика) данные за текущий день могут быть недоступны. В таких случаях выберите «Вчера».

2. **Окно выгрузки**:
   - Определяет количество дней до «До какой даты», которые будут включены в экспорт данных.
   - **Пример**:
     - Если «До какой даты» установлено на «Сегодня», а «Окно выгрузки» равно «7», приложение экспортирует данные за последние 7 дней, включая сегодня.
   - **Применение**:
     - Этот параметр позволяет указать, сколько недавних данных обновить.

3. **Параметры Cron**:
   - Определяет расписание для задачи, используя синтаксис cron.
   - **Информация**:
     - Cron — это планировщик заданий в Unix-подобных операционных системах.
     - Вы можете использовать [crontab.guru](https://crontab.guru/) в качестве помощника для создания выражения cron.
   - **Примеры**:
     - `* * * * *` : Запускается каждую минуту.
     - `0 * * * *` : Запускается каждый час в начале часа.
     - `15 18 * * *` : Запускается ежедневно в 18:15.
   - **Примечание**:
     - Обратите внимание на часовой пояс сервера (обычно UTC) при планировании задач.

---

## Часовые пояса и планирование задач

Сервер, на котором выполняются задачи, может использовать часовой пояс UTC. При указании «Параметры Cron» корректируйте время в соответствии с вашим местным часовым поясом.

- **Пример**:
  - Если вы хотите, чтобы задача запускалась в 18:15 по московскому времени (UTC+3), вам нужно установить время cron на `15 15 * * *` UTC.
- **Если задача не запускается в ожидаемое время**:
  - Проверьте разницу в часовых поясах и скорректируйте выражение cron.

---

## Индикаторы статуса задач

- **Зеленый значок**:
  - Указывает, что задача завершена без системных ошибок.
  - Даже если были небольшие ошибки (например, отсутствуют данные за конкретную дату или аккаунт), задача считается успешной.
  - **Рекомендация**:
    - Проверьте данные, чтобы убедиться, что все ожидаемые данные присутствуют.

- **Красный значок**:
  - Указывает, что во время выполнения задачи произошли системные ошибки.
  - Задача могла завершиться с ошибкой или столкнуться со значительными проблемами.

### Обработка отсутствующих данных и ошибок

- Если вы заметили отсутствие данных или ошибки, вы можете загрузить журналы ошибок из деталей задачи.
- Отправьте журналы в службу поддержки или разработчику для помощи.

---

## Дополнительные заметки

1. **Автоматическое создание таблиц**:
   - Приложение создает таблицы в ClickHouse на основе ваших данных и настроек.
   - Вам не нужно вручную создавать таблицы в ClickHouse.

2. **Валидация данных**:
   - Убедитесь, что все необходимые поля и параметры указаны правильно, чтобы избежать ошибок валидации.
   - Если возникает ошибка валидации, появится красное уведомление с указанием проблемы.

3. **Регулярное обновление данных**:
   - Используйте интервальные задачи с «Перезаписью по датам» и соответствующими «Параметрами Cron» для поддержания актуальности данных.
   - Регулярно запланированные задачи помогают поддерживать точные и актуальные данные в ваших дашбордах.

4. **Обработка ошибок**:
   - Приложение разработано так, чтобы продолжать обработку других аккаунтов, даже если возникают ошибки для конкретного аккаунта или даты.
   - Это означает, что ошибка в одном аккаунте не остановит всю задачу.

5. **Поддержка**:
   - Если вы столкнулись с проблемами, предоставьте журналы ошибок в службу поддержки для устранения неполадок.
   - Журналы можно загрузить со страницы деталей задачи.

---

