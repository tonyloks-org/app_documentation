# Задачи

## Оглавление
1. [Что такое задача](#что-такое-задача)
2. [Создание задачи](#создание-задачи)
3. [Опции обновления данных](#опции-обновления-данных)
4. [Тип задачи](#тип-задачи)
5. [Настройка интервальных задач](#настройка-интервальных-задач)
6. [Часовые пояса и планирование задач](#часовые-пояса-и-планирование-задач)
7. [Индикаторы статуса задач](#индикаторы-статуса-задач)
8. [Дополнительные заметки](#дополнительные-заметки)

---

## Что такое задача

**Задача** — это автоматизированный процесс экспорта данных из выбранных источников в указанное хранилище на основе заданных параметров и шаблонов. Задачи позволяют регулярно или по требованию получать актуальные данные для анализа, отчетности и дальнейшей обработки без необходимости ручного вмешательства.

### Основные компоненты задачи:

- **Импорт**: Шаблон выгрузки, определяющий источник данных и параметры экспорта.
- **Аккаунты**: Учетные записи, из которых будут экспортироваться данные.
- **Хранилище**: Место, куда будут сохраняться экспортированные данные.
- **Тип создания таблиц**: Способ организации данных в хранилище (отдельные таблицы для каждого аккаунта или объединение в одну таблицу).
- **Опции обновления данных**: Метод обновления существующих данных (полная перезапись, присоединение или перезапись по датам).
- **Тип задачи**: Единоразовая или интервальная задача с определенным расписанием.


---

## Создание задачи

Для создания задачи, которая экспортирует данные на основе вашего шаблона, выполните следующие шаги:

1. **Выбор импорта**: Выберите ранее настроенный импорт (шаблон выгрузки).
2. **Выбор аккаунтов**: Выберите аккаунты, которые допустимы для этого импорта. Можно выбрать несколько аккаунтов или все доступные для удобства.
3. **Выбор хранилища**: Выберите ранее настроенное хранилище.
4. **Тип создания таблиц**: Этот параметр определяет, как данные будут организованы в хранилище.

   - **Автоматически создать таблицы**:
     - Приложение создаст отдельные базы данных и таблицы для каждого аккаунта.
     - Названия баз данных основываются на названии вашего проекта из страницы «Подключения», переведенном в латиницу.
     - Название таблицы указывается вручную и одинаково для всех будущих таблиц.
     - Полезно, когда нужно хранить данные разных аккаунтов отдельно, например, для предоставления доступа отдельным клиентам или сотрудникам.
   
   - **В одну таблицу**:
     - Все данные из выбранных аккаунтов будут объединены в одной таблице в одной базе данных.
     - Удобно, когда требуется создать сводные дашборды с данными из нескольких аккаунтов.
     - Необходимо указать название базы данных и таблицы.
   
   ***Примечание***
   
   Название таблиц и баз указывайте без пробелов, без спецсимволов, только на латинице с нижними подчеркиваниями.
   
   **Можно:**
   - `my_database`
   - `sales_data_2024`
   - `client_accounts`
   
   **Нельзя:**
   - `my database`
   - `sales-data-2024!`
   - `клиенты@123`


---

## Опции обновления данных

Этот параметр контролирует, как данные обновляются в ваших таблицах:

1. **Полная перезапись**:
   - Приложение удалит все существующие данные в таблице и запишет новые данные.
   
   **Применение**:
     - Подходит для небольших таблиц с ограниченным объемом данных (например, данные из Google Sheets или содержание объявлений из Яндекс Директа с несколькими тысячами строк).
     - Не рекомендуется для больших наборов данных за несколько лет, так как это требует много ресурсов.

2. **Присоединение**:
   - Новые данные будут добавлены в существующую таблицу без удаления старых данных.
   - Приложение не обрабатывает и не удаляет существующие данные.
   
   **Применение**:
     - Полезно, когда нужно постоянно добавлять новые данные без изменения существующих записей.

3. **Перезапись по датам**:
   - Приложение удалит данные в указанном диапазоне дат и вставит новые данные за этот диапазон.
   - Позволяет обновлять недавние данные без затрагивания исторических данных.
   - **Поле для обновления**:
     - Необходимо указать поле, которое представляет дату в ваших данных (например, «Дата»).
     - Приложение использует это поле для определения, какие данные удалить и перезаписать.
     - Для этой цели можно выбрать только поля с датами.

---

## Тип задачи

Вы можете выбрать, как и когда будет выполняться задача:

1. **Единоразовая**:
   - Задача выполнится один раз, экспортируя данные за указанный диапазон дат.
   - **Применение**:
     - Подходит для экспорта исторических данных, которые не меняются (например, данные за последние два года).
   - **Настройка**:
     - Укажите начальную и конечную даты для экспорта данных.

2. **Интервальная**:
   - Задача запланирована на выполнение через определенные интервалы (например, ежедневно).
   - **Применение**:
     - Подходит для регулярного обновления данных в ваших таблицах.
   - **Настройка**:
     - Необходимо настроить дополнительные параметры для планирования и диапазона данных.

---

## Настройка интервальных задач

При выборе «Интервальная» в качестве типа задачи необходимо настроить следующие параметры:

1. **До какой даты**:
   - Указывает конечную дату для экспорта данных.
   - **Пример**:
     - Если вы хотите обновить данные до сегодня, выберите «Сегодня».
   - **Примечание**:
     - Для некоторых источников данных (например, Яндекс Метрика) данные за текущий день могут быть недоступны. В таких случаях выберите «Вчера».

2. **Окно выгрузки**:
   - Определяет количество дней до «До какой даты», которые будут включены в экспорт данных.
   - **Пример**:
     - Если «До какой даты» установлено на «Сегодня», а «Окно выгрузки» равно «7», приложение экспортирует данные за последние 7 дней, включая сегодня.

3. **Параметры Cron**:
   - Определяет расписание для задачи, используя синтаксис cron.
   - **Информация**:
     - Cron — это планировщик заданий в Unix-подобных операционных системах.
     - Вы можете использовать [crontab.guru](https://crontab.guru/) в качестве помощника для создания выражения cron.
   - **Примеры**:
     - `* * * * *` : Запускается каждую минуту.
     - `0 * * * *` : Запускается каждый час в начале часа.
     - `15 18 * * *` : Запускается ежедневно в 18:15.
   - **Примечание**:
     - Обратите внимание на часовой пояс сервера (обычно UTC) при планировании задач.

---

## Часовые пояса и планирование задач

Сервер, на котором выполняются задачи, может использовать часовой пояс UTC. При указании «Параметры Cron» корректируйте время в соответствии с вашим местным часовым поясом.

- **Пример**:
  - Если вы хотите, чтобы задача запускалась в 18:15 по московскому времени (UTC+3), вам нужно установить время cron на `15 15 * * *` UTC.
- **Если задача не запускается в ожидаемое время**:
  - Проверьте разницу в часовых поясах и скорректируйте выражение cron.

---

## Индикаторы статуса задач

- **Зеленый значок**:
  - Указывает, что задача завершена без системных ошибок.
  - Даже если были небольшие ошибки (например, отсутствуют данные за конкретную дату или аккаунт), задача считается успешной.
  - **Рекомендация**:
    - Проверьте данные, чтобы убедиться, что все ожидаемые данные присутствуют.

- **Красный значок**:
  - Указывает, что во время выполнения задачи произошли системные ошибки.
  - Задача могла завершиться с ошибкой или столкнуться со значительными проблемами.

### Обработка отсутствующих данных и ошибок

- Если вы заметили отсутствие данных или ошибки, вы можете выгрузить логи задачи и отправить их [мне](https://t.me/tonyornot)

---

