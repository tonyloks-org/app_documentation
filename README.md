# Документация приложения

## Приложение "Поток"

### Цель
**Выгрузка данных из рекламных систем для автоматизации рутинных аналитических действий и доступа к продвинутым технологиям аналитики.**

---

### Основные преимущества

#### 1. **Безлимитная выгрузка из рекламных систем**
- Вы можете подключить любое количество рекламных аккаунтов и таблиц Google Sheets (GS).

#### 2. **Выгрузка данных из разных аккаунтов одной системы в единую таблицу**
- Повышает удобство при построении визуализаций в DataLens.
- Упрощает процесс аналитики и мониторинга аккаунтов.

#### 3. **Автоматическое создание баз данных и таблиц в СУБД**
- Все основные сущности для работы с СУБД создаются автоматически.
- Позволяет использовать технологии быстрой обработки данных без необходимости глубоких знаний о них.

---

### Принцип работы
**Автономность**: Приложение работает в формате Enterprise, обозначающем, что оно создано для внутреннего использования. Я и никто другой не имеет доступа к данным внутри вашего приложения, в том числе логам и информации об ошибках.

---

### Используемые технологии
- **Микросервисы**: Python, Vue.js и Nginx.
- **Контейнеризация**: Хранение приложения в Docker.

---

### FAQ

#### ❓ Вопрос: **Как мне обновить приложение?**

✅ Ответ: Чтобы обновить приложение, выполните следующие действия:

1. Перейдите в папку с приложением и убедитесь, что в терминале путь отображается корректно:
    ```bash
    cd aoyad_app
    ```
2. Получите последние изменения из репозитория:
    ```bash
    git pull
    ```
3. Остановите старое приложение:
    ```bash
    docker-compose down
    ```
4. Скачайте новые контейнеры:
    ```bash
    docker-compose pull
    ```
5. Соберите новое приложение:
    ```bash
    docker-compose build
    ```
6. Запустите приложение:
    ```bash
    docker-compose up -d
    ```

---

#### ⚠️ Переход на версию 0.19.3 с более старой версии

Если вы обновляетесь **на версию 0.19.3** с любой предыдущей версии, обязательно выполните полный сброс всех параметров (все пароли и настройки будут сброшены):

1. Перейдите в папку с приложением:
    ```bash
    cd aoyad_app
    ```
2. Выполните полный сброс состояния репозитория и получите последние изменения из основной ветки:
    ```bash
    git reset --hard HEAD
    git pull origin main
    ```
3. Далее следуйте стандартной инструкции по обновлению выше.

---

#### ❓ Вопрос: **Как изменить пароль пользователя?**

✅ Ответ: Чтобы изменить пароль пользователя, выполните следующие действия:

1. Откройте файл `.env` в корне папки с приложением (`aoyad_app`).
2. Найдите переменную `APP_PASS`, отвечающую за пароль и задайте новое значение после знака =.
   
   > ⚠️ Пароль может содержать только английские буквы (a-z, A-Z), цифры и символ нижнего подчёркивания (`_`).
3. Сохраните изменения в файле `.env`.
4. Перезапустите приложение для применения нового пароля:
    ```bash
    docker-compose down
    docker-compose up -d
    ```
    После перезапуска приложения новый пароль будет применён.

---
#### ❓ Вопрос: **Что делать, если приложение не запускается, сервер лагает?**

✅ Ответ: Следуйте инструкциям ниже для проверки дискового пространства и очистки неиспользуемых Docker-образов:

1. **Проверьте текущее состояние диска:**
   ```bash
   df -h
   ```
   Команда покажет общий объём и доступное место на дисках в удобочитаемом формате.


2. **Очистите старые Docker-образы:**
   
   Перед использованием этой команды убедитесь, что приложение запущено. Иначе удалятся все образы, в том числе последние используемые с актуальными данными - подключениями, задачами.
   ```bash
   docker image prune -a -f
   ```
   Эта команда удаляет неиспользуемые Docker-образы, включая старые версии и контейнеры.

3. Удаление логов ClickHouse (если установлен вручную, НЕ через Docker)

```bash
sudo truncate -s 0 /var/log/clickhouse-server/*.log
```


4. После очистки Docker-образов и удаления логов ClickHouse, **проверьте, что место освободилось** с помощью команды `df -h`.

---


#### ❓ Вопрос: **У меня отсутствуют данные за N-ый период, что делать?**

✅ Ответ: Чтобы устранить разницу между данными в рекламном аккаунте и базе, выполните следующие шаги:

1. Сделайте запрос в СУБД к вашей таблице, который сгруппирует данные по дате и, например, по кликам:
    ```sql
    SELECT date, SUM(clicks)
    FROM your_table
    GROUP BY date;
    ```
2. Убедитесь, что данные действительно отличаются.

3. Если пропуск в данных найден, возможные причины:
    - Сервер мог зависнуть в момент выгрузки (например, произошло отключение интернет-соединения).
    - В приложении есть баг.  
      В этом случае пришлите мне в личные сообщения в Telegram логи задачи. Их можно получить, перейдя в конкретную задачу и нажав кнопку «Скачать файл».
