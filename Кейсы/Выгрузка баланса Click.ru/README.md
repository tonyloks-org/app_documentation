# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Click.ru —Å ClickHouse –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–∞–ª–∞–Ω—Å–æ–≤

> –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Click.ru —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ ClickHouse –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ DataLens).

---

**–ê–≤—Ç–æ—Ä:** [@Nikita_MarketingLife](https://t.me/Nikita_MarketingLife)

---

## üéØ –¶–µ–ª—å

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –∏—Ö –±–∞–ª–∞–Ω—Å–∞—Ö –∏–∑ Click.ru –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö –≤ ClickHouse –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ –∏ –¥–∞—à–±–æ—Ä–¥–æ–≤.

---

## üìù –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–°–µ—Ä–≤–µ—Ä:** –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å –û–° Ubuntu (–∏–ª–∏ –¥—Ä—É–≥–æ–π Linux-–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤)
- **Python:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Python 3 –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ pip
- **ClickHouse:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä ClickHouse. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
  - `CH_HOST` ‚Äî —Ö–æ—Å—Ç
  - `CH_PORT` ‚Äî –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 8123 –¥–ª—è HTTP)
  - `CH_USER` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `CH_PASSWORD` ‚Äî –ø–∞—Ä–æ–ª—å
- **Click.ru:** –î–æ—Å—Ç—É–ø –∫ –º–∞—Å—Ç–µ—Ä-–∞–∫–∫–∞—É–Ω—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è API Token –∏ UID

---

## üö¶ –®–∞–≥ 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö Click.ru

1. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –º–∞—Å—Ç–µ—Ä-–∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Click.ru
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ü—Ä–æ—Ñ–∏–ª—å**
3. –ü—Ä–æ–ª–∏—Å—Ç–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à **API Token**
4. –ù–∞–π–¥–∏—Ç–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à **UID** (—á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)

---

## ‚öôÔ∏è –®–∞–≥ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
sudo apt update

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python 3 –∏ pip (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
sudo apt install python3 python3-pip -y

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é Python-–±–∏–±–ª–∏–æ—Ç–µ–∫—É
pip3 install requests
```

---

## üêç –®–∞–≥ 3. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Python-—Å–∫—Ä–∏–ø—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/root/clickru_ch_sync.py`):

```bash
nano /root/clickru_ch_sync.py
```

> üí° **–°–æ–≤–µ—Ç:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤–µ—Å—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π Python-–∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ [`script.py`](https://github.com/tonyloks-org/app_documentation/blob/main/%D0%9A%D0%B5%D0%B9%D1%81%D1%8B/%D0%92%D1%8B%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0%20%D0%B1%D0%B0%D0%BB%D0%B0%D0%BD%D1%81%D0%B0%20Click.ru/script.py) –∏–∑ –ø–∞–ø–∫–∏ "–í—ã–≥—Ä—É–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞ Click.ru".

---

## ‚úèÔ∏è –®–∞–≥ 4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ, –ø–æ–¥—Å—Ç–∞–≤–∏–≤ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

```python
# --- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö CLICK.RU ---
API_TOKEN = "–í–ê–®_API_–¢–û–ö–ï–ù_–¢–£–¢"  # <--- –í–ê–® API –¢–û–ö–ï–ù
USER_ID = "–í–ê–®_UID_–¢–£–¢"          # <--- –í–ê–® UID

# --- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö CLICKHOUSE ---
CH_HOST = "localhost"            # <--- –•–û–°–¢ CLICKHOUSE (–µ—Å–ª–∏ –æ–Ω –Ω–µ –Ω–∞ —ç—Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ, —É–∫–∞–∂–∏—Ç–µ IP –∏–ª–∏ –¥–æ–º–µ–Ω)
CH_PORT = "8123"                 # <--- –ü–û–†–¢ CLICKHOUSE (HTTP)
CH_USER = "default"              # <--- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ CLICKHOUSE (–∏–ª–∏ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
CH_PASSWORD = "–í–ê–®_–ü–ê–†–û–õ–¨_–¢–£–¢"   # <--- –ü–ê–†–û–õ–¨ CLICKHOUSE
CH_DATABASE = "test_db"          # <--- –ò–ú–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–• (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞, –µ—Å–ª–∏ –Ω–µ—Ç)
CH_TABLENAME = "click_ru_balances" # <--- –ò–ú–Ø –¢–ê–ë–õ–ò–¶–´ (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞, –µ—Å–ª–∏ –Ω–µ—Ç)
```
---

## üß™ –®–∞–≥ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ—Ä–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è. –°–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ª–æ–≥–∏) –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Å–æ–ª—å.

```bash
python3 /root/clickru_ch_sync.py
```

- –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `[SUCCESS] ‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã`, –∑–Ω–∞—á–∏—Ç –≤—Å—ë –ø—Ä–æ—à–ª–æ —Ö–æ—Ä–æ—à–æ.
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `[FATAL] üî¥ –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ...` –∏–ª–∏ `[NO_DATA] ...`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, –≤–∞—à–∏ API-–∫–ª—é—á–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse.

---

## ‚è∞ –®–∞–≥ 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á)

–î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `crontab` –Ω–∞ Linux):

```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑ –≤ —á–∞—Å –≤ 5 –º–∏–Ω—É—Ç):

```cron
5 * * * * /usr/bin/python3 /root/clickru_ch_sync.py >> /var/log/clickru_ch_sync.log 2>&1
```

- `5 * * * *` ‚Äî –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ (5-—è –º–∏–Ω—É—Ç–∞ –∫–∞–∂–¥–æ–≥–æ —á–∞—Å–∞). –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é.
- `/usr/bin/python3` ‚Äî –ø—É—Ç—å –∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä—É Python (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π `which python3`).
- `/root/clickru_ch_sync.py` ‚Äî –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É —Å–∫—Ä–∏–ø—Ç—É.
- `>> /var/log/clickru_ch_sync.log 2>&1` ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–≤–æ–¥ –∏ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥-—Ñ–∞–π–ª.

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∑–∞–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:
```bash
crontab -l
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```bash
tail -f /var/log/clickru_ch_sync.log
```

---

## üìä –®–∞–≥ 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ClickHouse (`CH_DATABASE`) –ø–æ—è–≤–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `CH_TABLENAME` —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Click.ru. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ DataLens –∏–ª–∏ –¥—Ä—É–≥–∏–º BI-—Å–∏—Å—Ç–µ–º–∞–º, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `logging` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –æ—à–∏–±–æ–∫ –≤–º–µ—Å—Ç–æ `print()`.
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏) –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.
- –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`).
- –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–≥–µ—Ä–∞:

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] [user_id:%(user_id)s] %(message)s',
)
```

